<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPADE Security Monitor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-darker">

    <header class="text-center py-4 mb-3">
        <h4 id="current-date" class="text-muted fw-light mb-1">Loading date...</h4>
        <h1 class="display-5 fw-bold text-primary">Monitor Overview</h1>
    </header>

    <div class="container-fluid px-4">
        <div class="row g-4">
            <main class="col-lg-9">
                
                <div class="row g-4 mb-4">
                    <div class="col-md-4">
                        <div class="card h-100 card-custom text-center">
                            <div class="card-body d-flex flex-column justify-content-center">
                                <h5 class="card-title text-muted mb-3">Endpoint Status</h5>
                                <div class="d-flex justify-content-center align-items-baseline">
                                    <h2 class="fw-bold text-success mb-0" id="endpoints-online">-</h2>
                                    <span class="text-muted mx-2">/</span>
                                    <h4 class="text-muted mb-0" id="endpoints-total">-</h4>
                                </div>
                                <small class="text-muted mt-2">Online / Total</small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="card h-100 card-custom text-center">
                            <div class="card-body d-flex flex-column justify-content-center">
                                <h5 class="card-title text-muted mb-3">Total Alerts Today</h5>
                                <h2 class="display-4 fw-bold text-primary" id="total-alerts">-</h2>
                                <small class="text-muted">All detection rules</small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="card h-100 card-custom">
                            <div class="card-body p-3">
                                <h5 class="card-title text-muted text-center mb-2">Incoming Logs</h5>
                                <div class="chart-container" style="position: relative; height: 140px;">
                                    <canvas id="lineChart30s"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card card-custom">
                            <div class="card-header bg-transparent border-0 pt-3">
                                <h5 class="card-title mb-0">Detections by Rule Type</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" style="position: relative; height: 250px;">
                                    <canvas id="barChartRules"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="card card-custom">
                            <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center pt-3">
                                <h5 class="card-title mb-0">Recent Security Events</h5>
                                <span class="badge bg-primary" id="last-update-badge">Live</span>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive text-nowrap">
                                    <table class="table table-hover table-striped mb-0 align-middle">
                                        <thead class="table-dark">
                                            <tr>
                                                <th onclick="sortTable('time')">Time <span class="sort-icon" id="icon-time"></span></th>
                                                <th onclick="sortTable('severity')">Severity <span class="sort-icon" id="icon-severity"></span></th>
                                                <th onclick="sortTable('type')">Type <span class="sort-icon" id="icon-type"></span></th>
                                                <th onclick="sortTable('host')">Host <span class="sort-icon" id="icon-host"></span></th>
                                                <th onclick="sortTable('source')">Source App <span class="sort-icon" id="icon-source"></span></th>
                                                <th onclick="sortTable('extra')">Technique <span class="sort-icon" id="icon-extra"></span></th>
                                                <th>Details</th>
                                                <th onclick="sortTable('alert')">Alerted? <span class="sort-icon" id="icon-alert"></span></th>
                                            </tr>
                                        </thead>
                                        <tbody id="log-table-body" class="table-group-divider">
                                            </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <aside class="col-lg-3">
                <div class="card card-custom mb-4 sticky-top" style="top: 20px; z-index: 1;">
                    <div class="card-body d-flex flex-column align-items-center">
                        <h5 class="card-title mb-3">Today License Usage</h5>
                        
                        <div class="text-center mb-3">
                            <span id="license-used-text" class="fw-bold h2 mb-0">0 MB</span>
                            <div class="text-muted small">/ 500 MB</div>
                        </div>

                        <div style="height: 300px; width: 80px; background-color: #2c3035; border-radius: 15px; position: relative; overflow: hidden; border: 1px solid #373b3e;">
                            
                            <div id="license-progress-bar" 
                                 class="d-flex justify-content-center align-items-center bg-success text-white fw-bold" 
                                 style="position: absolute; bottom: 0; left: 0; width: 100%; height: 0%; transition: height 0.6s ease; font-size: 1rem; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
                                0%
                            </div>
                            
                        </div>
                        
                        <div class="mt-4 small text-muted w-100 px-2">
                            <div class="d-flex align-items-center mb-2"><span class="badge bg-success me-2" style="width:12px;height:12px;"></span> Safe</div>
                            <div class="d-flex align-items-center mb-2"><span class="badge bg-warning me-2" style="width:12px;height:12px;"></span> Warning (>400)</div>
                            <div class="d-flex align-items-center mb-2"><span class="badge bg-orange me-2" style="width:12px;height:12px;"></span> Critical (>450)</div>
                            <div class="d-flex align-items-center"><span class="badge bg-danger me-2" style="width:12px;height:12px;"></span> Over Limit</div>
                        </div>
                    </div>
                </div>
            </aside>
        </div> </div> <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>